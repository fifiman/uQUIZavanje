{% extends "quiz/base.html" %}


{% block title%}
    uQUIZavanje
{% endblock %}

{% block content %}

<h1>Game Question</h1>
<!-- Display the countdown timer in an element -->
<p id="demo"></p>
<h2 id="question_text"></h2><br>

<h3>Answer 1: </h3><h3 id="answer_one"></h3>
<button type="button" onclick="answer(0);">Answer 1</button><br><br>
<h3>Answer 2: </h3><h3 id="answer_two"></h3>
<button type="button" onclick="answer(1);">Answer 2</button><br><br>
<h3>Answer 3: </h3><h3 id="answer_three"></h3>
<button type="button" onclick="answer(2);">Answer 3</button><br><br>
<h3>Answer 4: </h3><h3 id="answer_four"></h3>
<button type="button" onclick="answer(3);">Answer 4</button><br><br>


<script>
// Set the date we're counting down to
var deadline = new Date();
//due to screen lag
deadline.setSeconds(deadline.getSeconds() + 12);

var countDownDate = deadline.getTime();

// Update the count down every 1 second
var x = setInterval(function() {

  // Get today's date and time
  var now = new Date().getTime();

  // Find the distance between now and the count down date
  var distance = countDownDate - now;

  // Time calculations for days, hours, minutes and seconds
  var seconds = Math.floor((distance % (1000 * 60)) / 1000);

  // Display the result in the element with id="demo"
  document.getElementById("demo").innerHTML = seconds + "s ";

  // If the count down is finished, write some text
  if (distance < 0) {
    clearInterval(x);
    document.getElementById("demo").innerHTML = "EXPIRED";
  }
}, 1000);
</script>
<script>
    var user_id         = "{{user_id}}"

    var question_id     = "question_text";
    var question_text   = "{{question.question}}";

    var answer_ids      = ['answer_one', 'answer_two', 'answer_three', 'answer_four'];
    var answer_texts    = ['{{question.answer_one}}', '{{question.answer_two}}', '{{question.answer_three}}', '{{question.answer_four}}']

    function fillData() {
        // Fill question.
        document.getElementById(question_id).innerHTML = question_text;

        for (var i = 0; i < 4; i++)
            document.getElementById(answer_ids[i]).innerHTML = answer_texts[i];
    }
    fillData();

    var game_id = "{{ game_id }}";

    var ws_path = 'ws://' + window.location.host + '/ws/game/{{ game_id }}';
    console.log("Connecting to " + ws_path);

    var gameSocket = new WebSocket(ws_path);

    function answer(answer_ind) {
        console.log("Answer: " + answer_ind);
        
        answer_data = {
            'command':      'answer',
            'game_id':      game_id,
            'answer_ind':   answer_ind,
            'user_id':      user_id
        };

        gameSocket.send(JSON.stringify(answer_data));
    }

    gameSocket.onmessage = function(message) {
        console.log('Received json: ', message);

        var data = JSON.parse(message.data);
        
        if (data.msg_type == 3) {
            window.location.replace("/game/" + game_id);
            return
        }
    }
</script>

{% endblock content %}